// https://github.com/jhchen/fast-diff/tree/bc1e462881948c4d97b6103efd655b47bc4aab05

var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;function diff_main(e,n,i,t){if(e===n)return e?[[DIFF_EQUAL,e]]:[];if(null!=i){var r=find_cursor_edit_diff(e,n,i);if(r)return r}var s=diff_commonPrefix(e,n),l=e.substring(0,s);e=e.substring(s),n=n.substring(s),s=diff_commonSuffix(e,n);var f=e.substring(e.length-s),g=diff_compute_(e=e.substring(0,e.length-s),n=n.substring(0,n.length-s));return l&&g.unshift([DIFF_EQUAL,l]),f&&g.push([DIFF_EQUAL,f]),diff_cleanupMerge(g,t),g}function diff_compute_(e,n){if(!e)return[[DIFF_INSERT,n]];if(!n)return[[DIFF_DELETE,e]];var i,t=e.length>n.length?e:n,r=e.length>n.length?n:e,s=t.indexOf(r);if(-1!==s)return i=[[DIFF_INSERT,t.substring(0,s)],[DIFF_EQUAL,r],[DIFF_INSERT,t.substring(s+r.length)]],e.length>n.length&&(i[0][0]=i[2][0]=DIFF_DELETE),i;if(1===r.length)return[[DIFF_DELETE,e],[DIFF_INSERT,n]];var l=diff_halfMatch_(e,n);if(l){var f=l[0],g=l[1],u=l[2],a=l[3],_=l[4],h=diff_main(f,u),c=diff_main(g,a);return h.concat([[DIFF_EQUAL,_]],c)}return diff_bisect_(e,n)}function diff_bisect_(e,n){for(var i=e.length,t=n.length,r=Math.ceil((i+t)/2),s=r,l=2*r,f=Array(l),g=Array(l),u=0;u<l;u++)f[u]=-1,g[u]=-1;f[s+1]=0,g[s+1]=0;for(var a=i-t,_=a%2!=0,h=0,c=0,$=0,F=0,o=0;o<r;o++){for(var E=-o+h;E<=o-c;E+=2){for(var d,b=s+E,D=(d=E===-o||E!==o&&f[b-1]<f[b+1]?f[b+1]:f[b-1]+1)-E;d<i&&D<t&&e.charAt(d)===n.charAt(D);)d++,D++;if(f[b]=d,d>i)c+=2;else if(D>t)h+=2;else if(_){var I=s+a-E;if(I>=0&&I<l&&-1!==g[I]){var p=i-g[I];if(d>=p)return diff_bisectSplit_(e,n,d,D)}}}for(var v=-o+$;v<=o-F;v+=2){for(var p,I=s+v,m=(p=v===-o||v!==o&&g[I-1]<g[I+1]?g[I+1]:g[I-1]+1)-v;p<i&&m<t&&e.charAt(i-p-1)===n.charAt(t-m-1);)p++,m++;if(g[I]=p,p>i)F+=2;else if(m>t)$+=2;else if(!_){var b=s+a-v;if(b>=0&&b<l&&-1!==f[b]){var d=f[b],D=s+d-b;if(d>=(p=i-p))return diff_bisectSplit_(e,n,d,D)}}}}return[[DIFF_DELETE,e],[DIFF_INSERT,n]]}function diff_bisectSplit_(e,n,i,t){var r=e.substring(0,i),s=n.substring(0,t),l=e.substring(i),f=n.substring(t),g=diff_main(r,s),u=diff_main(l,f);return g.concat(u)}function diff_commonPrefix(e,n){if(!e||!n||e.charAt(0)!==n.charAt(0))return 0;for(var i=0,t=Math.min(e.length,n.length),r=t,s=0;i<r;)e.substring(s,r)==n.substring(s,r)?s=i=r:t=r,r=Math.floor((t-i)/2+i);return is_surrogate_pair_start(e.charCodeAt(r-1))&&r--,r}function diff_commonSuffix(e,n){if(!e||!n||e.slice(-1)!==n.slice(-1))return 0;for(var i=0,t=Math.min(e.length,n.length),r=t,s=0;i<r;)e.substring(e.length-r,e.length-s)==n.substring(n.length-r,n.length-s)?s=i=r:t=r,r=Math.floor((t-i)/2+i);return is_surrogate_pair_end(e.charCodeAt(e.length-r))&&r--,r}function diff_halfMatch_(e,n){var i,t,r,s,l,f=e.length>n.length?e:n,g=e.length>n.length?n:e;if(f.length<4||2*g.length<f.length)return null;function u(e,n,i){for(var t,r,s,l,f=e.substring(i,i+Math.floor(e.length/4)),g=-1,u="";-1!==(g=n.indexOf(f,g+1));){var a=diff_commonPrefix(e.substring(i),n.substring(g)),_=diff_commonSuffix(e.substring(0,i),n.substring(0,g));u.length<_+a&&(u=n.substring(g-_,g)+n.substring(g,g+a),t=e.substring(0,i-_),r=e.substring(i+a),s=n.substring(0,g-_),l=n.substring(g+a))}return 2*u.length>=e.length?[t,r,s,l,u]:null}var a=u(f,g,Math.ceil(f.length/4)),_=u(f,g,Math.ceil(f.length/2));return a||_?(i=_?a&&a[4].length>_[4].length?a:_:a,e.length>n.length?(t=i[0],r=i[1],s=i[2],l=i[3]):(s=i[0],l=i[1],t=i[2],r=i[3]),[t,r,s,l,i[4]]):null}function diff_cleanupMerge(e,n){e.push([DIFF_EQUAL,""]);for(var i,t=0,r=0,s=0,l="",f="";t<e.length;){if(t<e.length-1&&!e[t][1]){e.splice(t,1);continue}switch(e[t][0]){case DIFF_INSERT:s++,f+=e[t][1],t++;break;case DIFF_DELETE:r++,l+=e[t][1],t++;break;case DIFF_EQUAL:var g=t-s-r-1;if(n){if(g>=0&&ends_with_pair_start(e[g][1])){var u=e[g][1].slice(-1);if(e[g][1]=e[g][1].slice(0,-1),l=u+l,f=u+f,!e[g][1]){e.splice(g,1),t--;var a=g-1;e[a]&&e[a][0]===DIFF_INSERT&&(s++,f=e[a][1]+f,a--),e[a]&&e[a][0]===DIFF_DELETE&&(r++,l=e[a][1]+l,a--),g=a}}if(starts_with_pair_end(e[t][1])){var u=e[t][1].charAt(0);e[t][1]=e[t][1].slice(1),l+=u,f+=u}}if(t<e.length-1&&!e[t][1]){e.splice(t,1);break}if(l.length>0||f.length>0){l.length>0&&f.length>0&&(0!==(i=diff_commonPrefix(f,l))&&(g>=0?e[g][1]+=f.substring(0,i):(e.splice(0,0,[DIFF_EQUAL,f.substring(0,i)]),t++),f=f.substring(i),l=l.substring(i)),0!==(i=diff_commonSuffix(f,l))&&(e[t][1]=f.substring(f.length-i)+e[t][1],f=f.substring(0,f.length-i),l=l.substring(0,l.length-i)));var _=s+r;0===l.length&&0===f.length?(e.splice(t-_,_),t-=_):0===l.length?(e.splice(t-_,_,[DIFF_INSERT,f]),t=t-_+1):0===f.length?(e.splice(t-_,_,[DIFF_DELETE,l]),t=t-_+1):(e.splice(t-_,_,[DIFF_DELETE,l],[DIFF_INSERT,f]),t=t-_+2)}0!==t&&e[t-1][0]===DIFF_EQUAL?(e[t-1][1]+=e[t][1],e.splice(t,1)):t++,s=0,r=0,l="",f=""}}""===e[e.length-1][1]&&e.pop();var h=!1;for(t=1;t<e.length-1;)e[t-1][0]===DIFF_EQUAL&&e[t+1][0]===DIFF_EQUAL&&(e[t][1].substring(e[t][1].length-e[t-1][1].length)===e[t-1][1]?(e[t][1]=e[t-1][1]+e[t][1].substring(0,e[t][1].length-e[t-1][1].length),e[t+1][1]=e[t-1][1]+e[t+1][1],e.splice(t-1,1),h=!0):e[t][1].substring(0,e[t+1][1].length)==e[t+1][1]&&(e[t-1][1]+=e[t+1][1],e[t][1]=e[t][1].substring(e[t+1][1].length)+e[t+1][1],e.splice(t+1,1),h=!0)),t++;h&&diff_cleanupMerge(e,n)}function is_surrogate_pair_start(e){return e>=55296&&e<=56319}function is_surrogate_pair_end(e){return e>=56320&&e<=57343}function starts_with_pair_end(e){return is_surrogate_pair_end(e.charCodeAt(0))}function ends_with_pair_start(e){return is_surrogate_pair_start(e.charCodeAt(e.length-1))}function remove_empty_tuples(e){for(var n=[],i=0;i<e.length;i++)e[i][1].length>0&&n.push(e[i]);return n}function make_edit_splice(e,n,i,t){return ends_with_pair_start(e)||starts_with_pair_end(t)?null:remove_empty_tuples([[DIFF_EQUAL,e],[DIFF_DELETE,n],[DIFF_INSERT,i],[DIFF_EQUAL,t]])}function find_cursor_edit_diff(e,n,i){var t="number"==typeof i?{index:i,length:0}:i.oldRange,r="number"==typeof i?null:i.newRange,s=e.length,l=n.length;if(0===t.length&&(null===r||0===r.length)){var f=t.index,g=e.slice(0,f),u=e.slice(f),a=r?r.index:null;editBefore:{var _=f+l-s;if(null!==a&&a!==_||_<0||_>l)break editBefore;var h=n.slice(0,_),c=n.slice(_);if(c!==u)break editBefore;var $=Math.min(f,_),F=g.slice(0,$),o=h.slice(0,$);if(F!==o)break editBefore;var E=g.slice($),d=h.slice($);return make_edit_splice(F,E,d,u)}editAfter:if(null===a||a===f){var b=f,h=n.slice(0,b),c=n.slice(b);if(h!==g)break editAfter;var D=Math.min(s-b,l-b),I=u.slice(u.length-D),p=c.slice(c.length-D);if(I!==p)break editAfter;var E=u.slice(0,u.length-D),d=c.slice(0,c.length-D);return make_edit_splice(g,E,d,I)}}if(t.length>0&&r&&0===r.length)replaceRange:{var F=e.slice(0,t.index),I=e.slice(t.index+t.length),$=F.length,D=I.length;if(l<$+D)break replaceRange;var o=n.slice(0,$),p=n.slice(l-D);if(F!==o||I!==p)break replaceRange;var E=e.slice($,s-D),d=n.slice($,l-D);return make_edit_splice(F,E,d,I)}return null}function diff(e,n,i){return diff_main(e,n,i,!0)}diff.INSERT=DIFF_INSERT,diff.DELETE=DIFF_DELETE,diff.EQUAL=DIFF_EQUAL;export default diff;